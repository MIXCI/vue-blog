<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-beta.36">
    <style>
      :root {
        --c-bg: rgba(0, 0, 0, 0.15);
      }
      html.dark {
        --c-bg: #22272e;
      }
      html, body {
        background-color: var(--c-bg);
      }
    </style>
    <!-- <script>
      const userMode = localStorage.getItem('vuepress-color-scheme');
			const systemDarkMode = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
			if (userMode === 'dark' || (userMode !== 'light' && systemDarkMode)) {
				document.documentElement.classList.toggle('dark', true);
			}
    </script> -->
    <title>Jenkins 使用 | 鹏展博</title><meta name="description" content="热爱生活">
    <link rel="modulepreload" href="/assets/app.87b1cd2a.js"><link rel="modulepreload" href="/assets/index.html.65aafe1c.js"><link rel="modulepreload" href="/assets/index.html.936b9e20.js"><link rel="modulepreload" href="/assets/plugin-vue_export-helper.21dcd24c.js">
    <link rel="stylesheet" href="/assets/style.3d9c7eaa.css">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container"><div class="navbar-wrapper"><div class="flex items-center"><div class="blog-title"><h3>鹏展博</h3></div></div><div class="flex items-center"><!--[--><a href="/" class="nav-link"><span>首页</span></a><a href="/category/" class="nav-link"><span>栏目</span></a><a href="/tags/" class="nav-link"><span>标签</span></a><a href="/archives/" class="nav-link"><span>归档</span></a><!--]--></div></div><!----><main class="post-wrapper"><div class="post-container"><!--[--><div class="post-meta"><h1>Jenkins 使用</h1></div><div class="post-meta-profile-border post-meta-profile"><div class="post-author"><span class="inline-block mr-1"><svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z" clip-rule="evenodd"></path><!----><!----><!----><!----><!----></svg></span><span>pengzhanbo</span></div><div class="post-category"><span class="inline-block mr-1"><svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><!----><path d="M2 6a2 2 0 012-2h5l2 2h5a2 2 0 012 2v6a2 2 0 01-2 2H4a2 2 0 01-2-2V6z"></path><!----><!----><!----><!----></svg></span><!--[--><!--[--><span>前端</span><span> / </span><!--]--><!--[--><span>工具</span><!----><!--]--><!--]--></div><!----><div class="post-createtime"><span class="inline-block mr-1"><svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><!----><!----><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path><!----><!----><!----></svg></span><span>2018-09-16</span></div></div><!--]--><main class="post-content"><!--[--><p><a href="https://jenkins.io/" target="_blank" rel="noopener noreferrer">Jenkins</a> 是一款功能强大的应用程序，允许持续集成和持续交付项目。这里记录一些 Jenkins 使用的方法。</p><p><em>以下基于 <code>CentOS</code> 系统。</em></p><h3 id="安装" tabindex="-1"><a class="header-anchor" href="#安装" aria-hidden="true">#</a> 安装</h3><p>安装详见 官网 <a href="https://jenkins.io/download/" target="_blank" rel="noopener noreferrer">Jenkins 安装</a> 流程，各个系统如何安装均有说明。</p><p>环境依赖： <code>java</code></p><p>CentOS 下安装：</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">sudo</span> <span class="token function">wget</span> -O /etc/yum.repos.d/jenkins.repo https://pkg.jenkins.io/redhat/jenkins.repo
<span class="token function">sudo</span> <span class="token function">rpm</span> --import https://pkg.jenkins.io/redhat/jenkins.io.key
yum <span class="token function">install</span> jenkins
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><ul><li><strong>默认安装目录</strong> : <code>/var/lib/jenkins</code></li><li><strong>默认日志目录</strong> ：<code>/var/log/jenkins</code></li><li><strong>默认缓存目录</strong> : <code>/var/cache/jenkins</code></li><li><strong>默认admin密码文件</strong> : <code>/var/lib/jenkins/secrets/initialAdminPassword</code></li><li><strong>配置文件</strong> : <code>/etc/sysconfig/jenkins</code></li></ul><h3 id="运行" tabindex="-1"><a class="header-anchor" href="#运行" aria-hidden="true">#</a> 运行</h3><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># 启动 Jenkins</span>
<span class="token function">service</span> jenkins start
<span class="token comment"># 重启 Jenkins</span>
<span class="token function">service</span> jenkins restart
<span class="token comment"># 停止 Jenkins</span>
<span class="token function">service</span> jenkins stop
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>默认运行在 <code>8080</code> 端口， 本机可通过 <code>localhost:8080</code> 访问。</p><h3 id="卸载" tabindex="-1"><a class="header-anchor" href="#卸载" aria-hidden="true">#</a> 卸载</h3><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">service</span> jenkiins stop
yum clean all
yum remove jenkins
<span class="token function">rm</span> -rf /var/lib/jenkins
<span class="token function">rm</span> -rf /var/cache/jenkins
<span class="token function">rm</span> -rf /var/log/jenkins
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h3 id="修改端口" tabindex="-1"><a class="header-anchor" href="#修改端口" aria-hidden="true">#</a> 修改端口</h3><ol><li>打开<code>Jenkins</code> 配置文件</li></ol><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">vim</span> /etc/sysconfig/jenkins
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br></div></div><ol start="2"><li>修改 <code>$HTTP_PORT</code></li></ol><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token variable">$HTTP_PORT</span><span class="token operator">=</span><span class="token string">&quot;8080&quot;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br></div></div><h3 id="获取root用户权限" tabindex="-1"><a class="header-anchor" href="#获取root用户权限" aria-hidden="true">#</a> 获取root用户权限</h3><ol><li>打开<code>Jenkins</code> 配置文件</li></ol><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">vim</span> /etc/sysconfig/jenkins
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br></div></div><ol start="2"><li>修改 <code>HTTP_PORT</code></li></ol><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token variable">$JENKINS_USER</span><span class="token operator">=</span><span class="token string">&quot;root&quot;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br></div></div><ol start="3"><li>修改<code>Jenkins</code> 相关目录权限</li></ol><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">chown</span> -R root:root /var/lib/jenkins
<span class="token function">chown</span> -R root:root /var/log/jenkins
<span class="token function">chown</span> -R root:root /var/cache/jenkins
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><ol start="4"><li>重启<code>Jenkins</code>并验证</li></ol><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">service</span> jenkins restart
<span class="token function">ps</span> -ef<span class="token operator">|</span><span class="token function">grep</span> jenkins
<span class="token comment"># 若显示为root用户，则表示修改完成</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h3 id="开机自启" tabindex="-1"><a class="header-anchor" href="#开机自启" aria-hidden="true">#</a> 开机自启</h3><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">chkconfig</span> jenkins on
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br></div></div><h3 id="全局工具配置" tabindex="-1"><a class="header-anchor" href="#全局工具配置" aria-hidden="true">#</a> 全局工具配置</h3><p>全局工具配置可以 配置相关工具如<code>Maven</code>、<code>GIT</code>等工具的路径、或者安装新的不同版本的工具。</p><p>配置该设置需要获取 <code>admin</code>权限，进入<code>系统管理 &gt; 全局工具配置</code>。</p><p>如：配置全局 GIT：</p><img src="/images/jenkins_globalconfig.png" class="zoom-custom-imgs" alt="全局配置git"><h3 id="用户管理以及用户权限" tabindex="-1"><a class="header-anchor" href="#用户管理以及用户权限" aria-hidden="true">#</a> 用户管理以及用户权限</h3><ul><li>使用<code>admin</code>权限的账号，进入<code>系统管理 &gt; 用户管理</code>, 可以添加/修改/删除 用户。</li><li>进入<code>系统管理 &gt; 全局安全配置</code> 中，勾选 <strong>启用安全</strong>。访问控制选择 <strong>Jenkins专有用户数据库</strong>，使用 <strong>项目矩阵授权策略</strong>, 可以为每个用户分配全局权限。</li><li>进入项目配置中，权限 <strong>启用项目安全</strong> 可以单独为该项目分配用户权限。 从而确保每个项目的安全性。</li></ul><h3 id="git-parameter" tabindex="-1"><a class="header-anchor" href="#git-parameter" aria-hidden="true">#</a> Git Parameter</h3><p>为项目添加 <code>git</code>分支/标签选择参数构建配置，从而方便通过不同分支构建项目。</p><p>项目配置： <img class="zoom-custom-imgs" src="https://wiki.jenkins-ci.org/download/attachments/58917601/image2018-9-20_22-0-7.png?version=1&amp;modificationDate=1537473611000&amp;api=v2" alt="Git Parameter"></p><p>参数化构建： <img class="zoom-custom-imgs" src="https://wiki.jenkins-ci.org/download/attachments/58917601/image2018-9-20_22-2-47.png?version=1&amp;modificationDate=1537473769000&amp;api=v2" alt="build width paramters form"></p><p>基础<code>pipeline</code>配置：</p><div class="language-groovy ext-groovy line-numbers-mode"><pre class="language-groovy"><code><span class="token comment">// Using git without checkout </span>
pipeline <span class="token punctuation">{</span>
  agent any
  parameters <span class="token punctuation">{</span>
    gitParameter branchFilter<span class="token punctuation">:</span> <span class="token string">&#39;origin/(.*)&#39;</span><span class="token punctuation">,</span> defaultValue<span class="token punctuation">:</span> <span class="token string">&#39;master&#39;</span><span class="token punctuation">,</span> name<span class="token punctuation">:</span> <span class="token string">&#39;BRANCH&#39;</span><span class="token punctuation">,</span> type<span class="token punctuation">:</span> <span class="token string">&#39;PT_BRANCH&#39;</span>
  <span class="token punctuation">}</span>
  stages <span class="token punctuation">{</span>
    <span class="token function">stage</span><span class="token punctuation">(</span><span class="token string">&#39;Example&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      steps <span class="token punctuation">{</span>
        git branch<span class="token punctuation">:</span> <span class="token string gstring">&quot;<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>params<span class="token punctuation">.</span>BRANCH<span class="token punctuation">}</span></span>&quot;</span><span class="token punctuation">,</span> url<span class="token punctuation">:</span> <span class="token string">&#39;https://github.com/jenkinsci/git-parameter-plugin.git&#39;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p><a href="https://plugins.jenkins.io/git-parameter" target="_blank" rel="noopener noreferrer">阅读插件原文（git-parameter）</a></p><h3 id="其他" tabindex="-1"><a class="header-anchor" href="#其他" aria-hidden="true">#</a> 其他</h3><p>相关工具以及项目配置，都只是小问题而已...</p><!--]--></main></div></main><!----></div><!--]--></div>
    <script type="module" src="/assets/app.87b1cd2a.js" defer></script>
  </body>
</html>
